#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google –¢–∞–±–ª–∏—Ü–∞–º
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

try:
    from bot import setup_google_sheet_headers, init_google_sheets, get_spreadsheet_info
except ImportError as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}")
    print("üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: pip install -r requirements.txt")
    sys.exit(1)

def test_google_sheets():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google –¢–∞–±–ª–∏—Ü–∞–º"""
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google –¢–∞–±–ª–∏—Ü–∞–º...\n")
    
    # –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    print("1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...")
    sheet = init_google_sheets()
    if sheet:
        print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google –¢–∞–±–ª–∏—Ü–∞–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
        print(f"üìã –ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞: '{sheet.title}'")
        print(f"üÜî ID –ª–∏—Å—Ç–∞: {sheet.id}")
        print(f"üìè –†–∞–∑–º–µ—Ä –ª–∏—Å—Ç–∞: {sheet.row_count} —Å—Ç—Ä–æ–∫ x {sheet.col_count} —Å—Ç–æ–ª–±—Ü–æ–≤")
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google –¢–∞–±–ª–∏—Ü–∞–º")
        print("\nüîß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:")
        print("‚Ä¢ –§–∞–π–ª google_credentials.json —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        print("‚Ä¢ ID —Ç–∞–±–ª–∏—Ü—ã –≤ config.py –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π")
        print("‚Ä¢ Service Account –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ")
        return False
    
    # –¢–µ—Å—Ç 1.5: –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–±–ª–∏—Ü–µ
    print("\n1Ô∏è‚É£.5Ô∏è‚É£ –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–±–ª–∏—Ü–µ...")
    info = get_spreadsheet_info()
    if info:
        print(f"üìä –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: '{info['title']}'")
        print(f"üÜî ID —Ç–∞–±–ª–∏—Ü—ã: {info['id']}")
        print(f"üîó URL: {info['url']}")
        print(f"üìÑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤: {len(info['sheets'])}")
        
        for i, sheet_info in enumerate(info['sheets'], 1):
            status = "üü¢ –ê–∫—Ç–∏–≤–Ω—ã–π" if sheet_info['is_active'] else "‚ö™ –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π"
            print(f"  {i}. {sheet_info['title']} {status} (ID: {sheet_info['id']}, {sheet_info['rows']}x{sheet_info['cols']})")
    else:
        print("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∞–±–ª–∏—Ü–µ")
    
    # –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    print("\n2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤...")
    if setup_google_sheet_headers():
        print("‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    else:
        print("‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤")
        return False
    
    # –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
    print("\n3Ô∏è‚É£ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–±–ª–∏—Ü–µ...")
    try:
        all_values = sheet.get_all_values()
        if all_values:
            print(f"üìä –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: {len(all_values)}")
            print(f"üìã –ó–∞–≥–æ–ª–æ–≤–∫–∏: {all_values[0] if all_values else '–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç'}")
            if len(all_values) > 1:
                print(f"üìà –ó–∞–ø–∏—Å–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏: {len(all_values) - 1}")
            else:
                print("üìù –ó–∞–ø–∏—Å–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏: 0")
        else:
            print("üìÑ –¢–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã: {e}")
        return False
    
    print("\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
    print("üí° Google –¢–∞–±–ª–∏—Ü—ã –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ —Å –±–æ—Ç–æ–º")
    return True

if __name__ == "__main__":
    print("=" * 50)
    print("üî¨ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï GOOGLE –¢–ê–ë–õ–ò–¶")
    print("=" * 50)
    
    success = test_google_sheets()
    
    print("\n" + "=" * 50)
    if success:
        print("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        print("üöÄ –ú–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞: ./start_bot.sh")
    else:
        print("‚ùå –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ù–ï–£–°–ü–ï–®–ù–û")
        print("üîß –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç —Å–Ω–æ–≤–∞")
    print("=" * 50)
